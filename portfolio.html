<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Trade Winners — Portfolio</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Netlify Identity Widget -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<style>
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 2rem;
  }
  .brand {
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
    color: inherit;
  }
  .nav a {
    margin: 0 10px;
    text-decoration: none;
    font-weight: 500;
  }
  #investment-club-btn {
    font-weight: 500;
    color: #0b5fff;
    cursor: pointer;
    background: none;
    border: none;
    margin-left: 15px;
  }
  #investment-club-btn:hover {
    color: #071029;
  }
</style>
</head>
<body>
  <header class="header">
    <a class="brand" href="index.html">
      <img src="logo.png" alt="Trade Winners logo" style="height:40px;">
      <span class="title">Trade Winners</span>
    </a>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="portfolio.html">Portfolio</a>
      <a href="contact.html">Contact</a>
      <a href="disclaimer.html">Disclaimer</a>
      <button id="investment-club-btn">Investment Club</button>
    </nav>
  </header>

  <!-- Main portfolio content (hidden until login) -->
  <main class="main" id="main-content" style="display:none;">
    <section class="card">
      <h2>Portfolio Allocation</h2>
      <div style="display:flex;gap:20px;flex-wrap:wrap">
        <div style="flex:1;min-width:260px">
          <canvas id="allocChart" style="max-height:300px"></canvas>
        </div>
        <div style="flex:1;min-width:260px">
          <div style="background:#fbfdff;padding:14px;border-radius:8px">
            <h3 style="margin:0 0 8px 0">Portfolio Snapshot</h3>
            <p style="margin:0;color:#6b7280">Performance YTD: <strong style="color:#0b5fff">+38.1%</strong></p>
            <h4 style="margin:12px 0 8px 0; color:#071029">Top 3 Holdings (by % of Portfolio):</h4>
            <p style="margin:0;color:#6b7280">Rolls Royce: <strong style="color:#0b5fff">+807.79%</strong></p>
            <p style="margin:0;color:#6b7280">Carnival: <strong style="color:#0b5fff">+91.09%</strong></p>
            <p style="margin:0;color:#6b7280">Vanguard S&P 500 (Dist): <strong style="color:#0b5fff">+46.50%</strong></p>
          </div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Performance</h2>
      <div class="chart-box">
        <canvas id="growthChart" style="max-height:320px"></canvas>
      </div>
    </section>

    <section class="card">
      <h2>Key Stocks</h2>
      <div style="max-width:820px">
        <div class="tradingview-widget-container">
          <div id="tv-mini-2"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
          {
            "symbol": "LSE:RR",
            "width": "100%",
            "height": "220",
            "locale": "en",
            "dateRange": "12M"
          }
          </script>
        </div>
      </div>
    </section>
  </main>

  <!-- Login prompt when logged out -->
  <section id="login-prompt" class="card" style="text-align:center; display:none;">
    <h2>Investment Club</h2>
    <p>Please log in to view the portfolio content.</p>
    <button onclick="netlifyIdentity.open('login')" style="font-family: inherit; color: #fff; background-color: #0b5fff; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Log In</button>
  </section>

  <footer class="footer">© Trade Winners — Educational content only.</footer>

<script>
// Charts
function renderCharts() {
  const allocCtx = document.getElementById('allocChart').getContext('2d');
  new Chart(allocCtx, {
    type: 'doughnut',
    data: {
      labels:['Rolls Royce','Carnival','Vanguard S&P 500 (Dist)','Microsoft','Vanguard FTSE All-world High dividend yield','AMD','Alphabet','Other'],
      datasets:[{data:[17.2,7.1,6.92,6.77,5.59,5.13,4.57,46.72],backgroundColor:['#0b5fff','#4caf50','#ffb020','#9e9e9e','#E040FB','#00BCD4','#FF9800','#795548']}]
    },
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom'}}}
  });

  const growthCtx = document.getElementById('growthChart').getContext('2d');
  new Chart(growthCtx, {
    type:'line',
    data:{
      labels:['2023','2024'],
      datasets:[{label:'Portfolio value',data:[20,55],borderColor:'#0b5fff',tension:0.3,fill:true,backgroundColor:'rgba(11,95,255,0.08)'}]
    },
    options:{responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:false}}}
  });
}

// Identity handling
netlifyIdentity.on('init', user => updateUI(user));
netlifyIdentity.on('login', user => updateUI(user));
netlifyIdentity.on('logout', () => updateUI(null));

function updateUI(user) {
  const mainContent = document.getElementById('main-content');
  const loginPrompt = document.getElementById('login-prompt');

  if (user) {
    mainContent.style.display = 'block';
    loginPrompt.style.display = 'none';
    renderCharts();
    document.getElementById('investment-club-btn').textContent = 'Log Out';
  } else {
    mainContent.style.display = 'none';
    loginPrompt.style.display = 'block';
    document.getElementById('investment-club-btn').textContent = 'Investment Club';
  }
}

// Button click
document.getElementById('investment-club-btn').addEventListener('click', () => {
  const user = netlifyIdentity.currentUser();
  if (user) {
    netlifyIdentity.logout();
  } else {
    netlifyIdentity.open('login');
  }
});
</script>
</body>
</html>
