<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Trade Winners — Portfolio</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Netlify Identity Widget -->
<script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<style>
  /* This custom CSS ensures the header uses flexbox for proper alignment */
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 2rem;
  }

  /* This custom CSS styles the Netlify Identity widget button to match the navigation links */
  [data-netlify-identity-menu] a,
  [data-netlify-identity-menu] button {
    font-family: inherit;
    font-size: 1rem;
    font-weight: 500;
    color: #0b5fff;
    text-decoration: none;
    border: none;
    background: transparent;
    cursor: pointer;
    padding: 1rem 0.5rem;
  }

  [data-netlify-identity-menu] a:hover,
  [data-netlify-identity-menu] button:hover {
    color: #071029;
  }
</style>
</head>
<body>
  <header class="header">
    <a class="brand" href="index.html">
      <img src="logo.png" alt="Trade Winners logo">
      <span class="title">Trade Winners</span>
    </a>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="portfolio.html">Portfolio</a>
      <a href="contact.html">Contact</a>
      <a href="disclaimer.html">Disclaimer</a>
    </nav>
    <!-- Placeholder for the Netlify Identity widget -->
    <div data-netlify-identity-menu></div>
  </header>

  <!-- This is the main content, which will be hidden until a user logs in -->
  <main class="main" id="main-content" style="display: none;">
    <section class="card">
      <h2>Portfolio Allocation</h2>
      <div style="display:flex;gap:20px;flex-wrap:wrap">
        <div style="flex:1;min-width:260px">
          <canvas id="allocChart" style="max-height:300px"></canvas>
        </div>
        <div style="flex:1;min-width:260px">
          <div style="background:#fbfdff;padding:14px;border-radius:8px">
            <h3 style="margin:0 0 8px 0">Portfolio Snapshot</h3>
            <p style="margin:0;color:#6b7280">Performance YTD: <strong style="color:#0b5fff">+38.1%</strong></p>
            <h4 style="margin:12px 0 8px 0; color:#071029">Top 3 Holdings (by % of Portfolio):</h4>
            <p style="margin:0;color:#6b7280"><a href="https://www.tradingview.com/symbols/LSE-RR/" target="_blank">Rolls Royce</a>: <strong style="color:#0b5fff">+807.79%</strong></p>
            <p style="margin:0;color:#6b7280"><a href="https://www.tradingview.com/symbols/LSE-CCL/" target="_blank">Carnival</a>: <strong style="color:#0b5fff">+91.09%</strong></p>
            <p style="margin:0;color:#6b7280"><a href="https://www.tradingview.com/symbols/AMEX-VUSA/" target="_blank">Vanguard S&P 500 (Dist)</a>: <strong style="color:#0b5fff">+46.50%</strong></p>
          </div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Performance</h2>
      <div class="chart-box">
        <canvas id="growthChart" style="max-height:320px"></canvas>
      </div>
    </section>

    <section class="card">
      <h2>Key Stocks</h2>
      <div style="max-width:820px">
        <div class="tradingview-widget-container">
          <div id="tv-mini-2"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
          {
            "symbol": "LSE:RR",
            "width": "100%",
            "height": "220",
            "locale": "en",
            "dateRange": "12M"
          }
          </script>
        </div>
        <p style="text-align:center; margin-top:15px;">
          To view other top performing stocks, update the "symbol" in the script above. Top performers: RR.L (Rolls Royce), NVDA (Nvidia), RDDT (Reddit).
        </p>
      </div>
    </section>
  </main>

  <!-- This is the login prompt, which will be shown when the user is logged out -->
  <section id="login-prompt" class="card" style="display: none; text-align: center;">
    <h2>Investment Club</h2>
    <p>Please log in to view the full portfolio content.</p>
    <button onclick="netlifyIdentity.open()" style="font-family: inherit; color: #fff; background-color: #0b5fff; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Log In</button>
  </section>

  <footer class="footer">© Trade Winners — Educational content only.</footer>

<script>
// A function to draw the charts. This prevents them from trying to render on a hidden canvas.
const renderCharts = () => {
  // Chart: Allocation (pie) - Top 7 holdings from CSV, rest grouped into 'Other'
  const allocCtx = document.getElementById('allocChart').getContext('2d');
  new Chart(allocCtx, {
    type: 'doughnut',
    data: {
      labels: ['Rolls Royce', 'Carnival', 'Vanguard S&P 500 (Dist)', 'Microsoft', 'Vanguard FTSE All-world High dividend yield', 'AMD', 'Alphabet', 'Other'],
      datasets: [{
        data: [17.2, 7.1, 6.92, 6.77, 5.59, 5.13, 4.57, 46.72],
        backgroundColor: ['#0b5fff', '#4caf50', '#ffb020', '#9e9e9e', '#E040FB', '#00BCD4', '#FF9800', '#795548']
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom'
        }
      }
    }
  });

  // Chart: Performance (line)
  const growthCtx = document.getElementById('growthChart').getContext('2d');
  new Chart(growthCtx, {
    type: 'line',
    data: {
      labels: ['2023', '2024'],
      datasets: [{
        label: 'Portfolio value',
        data: [20, 55],
        borderColor: '#0b5fff',
        tension: 0.3,
        fill: true,
        backgroundColor: 'rgba(11,95,255,0.08)'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: false
        }
      }
    }
  });
};

// Function to update the UI based on login status
const updateUI = (user) => {
    const mainContent = document.getElementById('main-content');
    const loginPrompt = document.getElementById('login-prompt');
    const identityMenu = document.querySelector('[data-netlify-identity-menu]');

    if (user) {
        // User is logged in, show the main content and render charts
        mainContent.style.display = 'block';
        loginPrompt.style.display = 'none';
        renderCharts();
    } else {
        // User is logged out, hide the main content and show the login prompt
        mainContent.style.display = 'none';
        loginPrompt.style.display = 'block';
        
        // Wait for the Netlify Identity widget to load
        if (netlifyIdentity) {
            const observer = new MutationObserver((mutations, obs) => {
              const loginLink = identityMenu.querySelector('a[href="#login"]');
              const signupLink = identityMenu.querySelector('a[href="#signup"]');
              if (loginLink) {
                // Change the login link text
                loginLink.textContent = 'Investment Club';
                obs.disconnect(); // Stop observing once we've found the button
              }
            });
            observer.observe(identityMenu, { childList: true, subtree: true });
        }
    }
};

// Listen for authentication state changes and call updateUI
window.netlifyIdentity.on('init', updateUI);
window.netlifyIdentity.on('login', updateUI);
window.netlifyIdentity.on('logout', () => {
  updateUI(null);
});
</script>

</body>
</html>
