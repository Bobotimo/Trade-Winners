<script>
// Initialise Netlify Identity
if (window.netlifyIdentity) {
  netlifyIdentity.init();

  netlifyIdentity.on('init', user => {
    updateUI(user);
  });

  netlifyIdentity.on('login', user => {
    updateUI(user);
  });

  netlifyIdentity.on('logout', () => {
    updateUI(null);
  });
}

function updateUI(user) {
  const mainContent = document.getElementById('main-content');
  const loginPrompt = document.getElementById('login-prompt');

  if (user) {
    // Show content for logged-in users
    mainContent.style.display = 'block';
    loginPrompt.style.display = 'none';
    renderCharts();
  } else {
    // Show login prompt for logged-out users
    mainContent.style.display = 'none';
    loginPrompt.style.display = 'block';
  }
}

// Chart rendering function
function renderCharts() {
  // Allocation Chart
  const allocCtx = document.getElementById('allocChart').getContext('2d');
  new Chart(allocCtx, {
    type: 'doughnut',
    data: {
      labels: ['Rolls Royce', 'Carnival', 'Vanguard S&P 500 (Dist)', 'Microsoft', 'Vanguard FTSE All-world High dividend yield', 'AMD', 'Alphabet', 'Other'],
      datasets: [{
        data: [17.2, 7.1, 6.92, 6.77, 5.59, 5.13, 4.57, 46.72],
        backgroundColor: ['#0b5fff', '#4caf50', '#ffb020', '#9e9e9e', '#E040FB', '#00BCD4', '#FF9800', '#795548']
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { position: 'bottom' } }
    }
  });

  // Growth Chart
  const growthCtx = document.getElementById('growthChart').getContext('2d');
  new Chart(growthCtx, {
    type: 'line',
    data: {
      labels: ['2023', '2024'],
      datasets: [{
        label: 'Portfolio value',
        data: [20, 55],
        borderColor: '#0b5fff',
        tension: 0.3,
        fill: true,
        backgroundColor: 'rgba(11,95,255,0.08)'
      }]
    },
    options: { responsive: true, maintainAspectRatio: false }
  });
}
</script>
